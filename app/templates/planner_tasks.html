{% extends 'base.html' %}

{% block title %}SAP Notifications â€¢ CBM Portal{% endblock %}

{% block content %}
  <style>
  /* Scoped styles to make the planner table larger and responsive */
  .planner-container {
    width: 100%;
    max-width: none;
    margin: 16px 8px;
    padding: 12px;
    box-sizing: border-box;
  }

  .planner-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 16px; /* slightly larger */
    background: #fff;
    box-shadow: 0 2px 8px rgba(27,31,35,0.08);
    border-radius: 8px;
    overflow: hidden;
  }

  .planner-table th,
  .planner-table td {
    padding: 12px 14px;
    text-align: left;
    vertical-align: middle;
    border-bottom: 1px solid rgba(0,0,0,0.06);
    white-space: nowrap;
  }

  .planner-table td[style], /* keep existing inline styles for files but allow wrapping */
  .planner-table td:last-child {
    white-space: normal;
    max-width: 420px;
    word-break: break-word;
  }

  /* Make the table horizontally scroll on very small windows */
  @media (max-width: 900px) {
    .planner-container { padding: 8px; }
    .planner-table th, .planner-table td { padding: 10px 8px; font-size: 15px; }
  }

  .planner-value {
    font-style: italic;
    color: #0073e6; /* nice blue shade */
}

  /* Ensure small screens can scroll the table */
  .planner-container { overflow-x: auto; }
  .planner-table { min-width: 900px; }
  </style>
  <main class="planner-container">
    {% if planner_meta %}
    <h1>
      <strong>Equipment:</strong> <span class="planner-value">{{ planner_meta.equipment }}</span> &nbsp;| 
      <strong>Department:</strong> <span class="planner-value">{{ planner_meta.department }}</span> &nbsp;| 
      <strong>Week/Year:</strong> <span class="planner-value">{{ planner_meta.week_number }}/{{ planner_meta.year }}</span>
    </h1>
    {% endif %}

    <table class="planner-table no-wrap">
      <thead>
        <tr>
    <th>Testing Type</th>
    <th>Status</th>
    <th>Alarm Level</th>
    <th>Done Tested Date</th>
    <th>Notes</th>
  <th>Files</th>
  <th>Technician</th>
  <th>Notification</th>
        </tr>
      </thead>
      <tbody>
      {% for t in tasks %}
        <tr>
          <td>{{ t.Test_Type }}</td>
          <td>
            <span class="badge">{{ t.Status }}</span>
          </td>
          <td>
            {% set av = (t.Alarm_Level or '-') %}
            {% set acls = 'alarm-normal' %}
            {% if av == 'Critical' %}{% set acls = 'alarm-critical' %}{% elif av == 'Warning' %}{% set acls = 'alarm-warning' %}{% endif %}
            <span class="badge {{ acls }}">{{ av }}</span>
          </td>
    <td>{{ (t.Done_Tested_Date or '-') }}</td>
          <td>{{ t.Notes or '' }}</td>
    <td style="white-space:normal; max-width:500px;">
            {% if t.attachments and t.attachments|length > 0 %}
              <ul style="list-style:none; padding:0; margin:0;">
                {% for f in t.attachments %}
                  <li style="display:flex; align-items:center; gap:6px; margin:2px 0;">
        <a href="{{ url_for('technician.view_attachment', attachment_id=f.id) }}" target="_blank" rel="noopener">{{ f.filename }}</a>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <span style="color:#888;">No files</span>
            {% endif %}
          </td>
          <td>{{ t.technician_name or '-' }}</td>
          <td>{{ t.notification or '-' }}</td>
        </tr>
      {% else %}
        <tr>
    <td colspan="8" style="text-align:center; color:#666;">No linked tests for this planner.</td>
        </tr>
        
      {% endfor %}
      </tbody>
    </table>
  </main>
 {% endblock %}

