{% extends 'technician/_type_base.html' %}
{# Planner base for planner-related pages: provides a shared sidebar and layout. #}
{% block content %}
  <!-- ensure planner stylesheet loads for planner pages -->
  <link rel="stylesheet" href="/static/planner.css">
  <div class="planner-layout">
    <aside class="planner-sidebar" aria-label="Planner navigation">
      <div class="sb-inner">
        <div class="sb-top">
          <button id="sbCollapsePlanner" class="sb-toggle" type="button" aria-label="Toggle sidebar" title="Collapse">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
          </button>
          <div class="sb-brand">
            <div class="logo">CBM</div>
            <div class="brand-text">
              <div class="brand-title">CBM Portal</div>
              <div class="brand-sub">Reliability Dashboard</div>
            </div>
          </div>
        </div>

        <nav class="sb-nav" role="navigation">
          <div class="nav-group" aria-label="Planner">
            <a href="/planner" class="nav-item {% if request.path == '/planner' %}is-active{% endif %}" title="Weekly Equipment PM Planner">
              <span class="nav-icon" aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10h18v11H3z"></path><path d="M7 10V6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v4"></path></svg>
              </span>
              <span class="nav-label">Manual Scheduling</span>
            </a>
            <a href="/planner_entries" class="nav-item {% if request.path == '/planner_entries' %}is-active{% endif %}" title="Planner Entries" {% if request.path == '/planner_entries' %}aria-current="page"{% endif %}>
              <span class="nav-icon" aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/></svg>
              </span>
              <span class="nav-label">CBM Schedule</span>
            </a>
            <a href="/notification_for" class="nav-item {% if request.path == '/notification_for' %}is-active{% endif %}" title="For SAP Notifications">
              <span class="nav-icon" aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0 1 18 14.158V11a6 6 0 1 0-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5"></path></svg>
              </span>
              <span class="nav-label">For SAP Notification</span>
            </a>
          </div>
        </nav>

        <div class="sb-bottom">
          <a href="{{ url_for('main.notification') }}" class="nav-item" title="SAP Notifications">
            <img src="{{ url_for('static', filename='icons/SAP.png') }}" class="icon-img default-icon">
            <img src="{{ url_for('static', filename='icons/SAP.png') }}" class="icon-img active-icon"></span>
            <span class="nav-label">CBM‚Ä¢SAP Notifications</span> </a>
          <a href="{{ url_for('main.index') }}" class="nav-item" title="Back to Dashboard">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Dashboard</span>
          </a>
        </div>
      </div>
    </aside>

    <main class="planner-shell" id="plannerMain" tabindex="-1">
      {% block planner_content %}{% endblock %}
    </main>
  </div>
  <script>
    // Hide global sidebar and remove its app-shell margin while on planner pages
    (function(){
      document.addEventListener('DOMContentLoaded', function(){
        var globalSidebar = document.querySelector('.cbm-sidebar');
        var appShell = document.querySelector('.app-shell');
        if(globalSidebar) globalSidebar.classList.add('planner-hidden');
        if(appShell) appShell.classList.add('app-shell--planner');
        // Planner sidebar collapse handling
        try {
          var pSidebar = document.querySelector('.planner-sidebar');
          var pShell = document.querySelector('.planner-shell');
          var btn = document.getElementById('sbCollapsePlanner');
          if (pSidebar && pShell && btn) {
            var apply = function(collapsed){
              pSidebar.classList.toggle('is-collapsed', !!collapsed);
              pShell.classList.toggle('planner-collapsed', !!collapsed);
            };
            // restore persisted state
            var stored = null;
            try { stored = localStorage.getItem('cbm:planner-sb-collapsed'); } catch(_) {}
            apply(stored === '1');
            btn.addEventListener('click', function(){
              var isCollapsed = pSidebar.classList.toggle('is-collapsed');
              pShell.classList.toggle('planner-collapsed', isCollapsed);
              try { localStorage.setItem('cbm:planner-sb-collapsed', isCollapsed ? '1' : '0'); } catch(_) {}
            });
          }
        } catch(_) {}
        // restore when navigating away (optional)
        window.addEventListener('beforeunload', function(){ if(globalSidebar) globalSidebar.classList.remove('planner-hidden'); if(appShell) appShell.classList.remove('app-shell--planner'); });
      });
    })();
  </script>
{% endblock %}
