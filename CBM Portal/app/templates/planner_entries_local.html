<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Planner Entries (Local)</title>
	<link rel="stylesheet" href="/static/style.css">
	<script src="/static/main.js" defer></script>
</head>
<body>
	<header class="page-header">
		<h1>Planner Entries</h1>
		<a href="/planner" class="btn-secondary" style="margin-left:auto;">Back to Planner</a>
	</header>

	<main class="planner-container">
		<table class="planner-table no-wrap" style="margin-top: 12px;">
			<thead>
				<tr>
					<th>ID</th>
					<th>Week</th>
					<th>Year</th>
					<th>Department</th>
					<th>Equipment</th>
					<th>Date</th>
					<th>Day</th>
					<th>PM Date</th>
					<th>Schedule Type</th>
					<th>Status/Alarm</th>
					<th>Tasks</th>
					<th>Testing Types</th>
				</tr>
			</thead>
			<tbody>
				{% for p in recent_planners %}
					<tr>
						<td>{{ p.id }}</td>
						<td>{{ p.week_number }}</td>
						<td>{{ p.year }}</td>
						<td>{{ p.department }}</td>
						<td>{{ p.equipment }}</td>
						<td>{{ p.date }}</td>
						<td>{{ p.day }}</td>
						<td>{{ p.pm_date }}</td>
						<td>
							{% if p.schedule_type %}
								{% set sc = p.schedule_type|lower %}
								<span class="{{ 'schedule-planned' if sc=='planned' else ('schedule-unplanned' if sc=='unplanned' else ('schedule-validation' if sc=='validation' else '')) }}">{{ p.schedule_type }}</span>
							{% else %}
								-
							{% endif %}
						</td>
						<td>
							{% set st = p.status_filled or 0 %}
							{% set at = p.alarm_filled or 0 %}
							{% set tt = p.total_tests or 0 %}
							<span class="badge">Status: {{ st }}/{{ tt }}</span>
							<span class="badge">Alarm: {{ at }}/{{ tt }}</span>
							{% if p.worst_alarm %}
								<span class="badge {{ 'alarm-critical' if p.worst_alarm=='Critical' else ('alarm-warning' if p.worst_alarm=='Warning' else 'alarm-normal') }}">{{ p.worst_alarm }}</span>
							{% endif %}
						</td>
						<td>
							<a class="btn-secondary" href="{{ url_for('main.planner_tasks', planner_id=p.id) }}" style="padding:4px 8px; text-decoration:none;">View</a>
						</td>
									<td>
										{% if p.testing_types_list and p.testing_types_list|length > 0 %}
											{% for t in p.testing_types_list %}
												{% set key = t.lower() %}
												{% set cls = 'other' %}
												{% if 'vibration' in key %}{% set cls = 'va' %}{% endif %}
												{% if 'oil' in key %}{% set cls = 'oil' %}{% endif %}
												{% if 'thermal' in key %}{% set cls = 'thermal' %}{% endif %}
												{% if 'ultrasonic leak' in key %}{% set cls = 'leak' %}{% elif 'ultrasonic' in key %}{% set cls = 'ultra' %}{% endif %}
												{% if 'motor dynamic' in key %}{% set cls = 'mda' %}{% endif %}
												{% if 'balancing' in key %}{% set cls = 'balance' %}{% endif %}
												{% set cat = 'other' %}
												{% if 'vibration' in key %}{% set cat = 'vibration' %}{% endif %}
												{% if 'oil' in key %}{% set cat = 'oil' %}{% endif %}
												{% if 'thermal' in key %}{% set cat = 'thermal' %}{% endif %}
												{% if 'ultrasonic leak' in key %}{% set cat = 'leak_detection' %}{% elif 'ultrasonic' in key %}{% set cat = 'ultrasonic' %}{% endif %}
												{% if 'motor dynamic' in key %}{% set cat = 'motor_dynamic' %}{% endif %}
												{% if 'balancing' in key %}{% set cat = 'balancing' %}{% endif %}
												<a class="tag {{ cls }}" href="{{ url_for('technician.by_category', category=cat, planner_id=p.id) }}" title="Open {{ t }} tasks">{{ t }}</a>
											{% endfor %}
										{% else %}
											-
										{% endif %}
									</td>
					</tr>
				{% endfor %}
				{% if recent_planners|length == 0 %}
					<tr><td colspan="12" style="text-align:center; color:#666;">No entries found.</td></tr>
				{% endif %}
			</tbody>
		</table>
	</main>
</body>
</html>
